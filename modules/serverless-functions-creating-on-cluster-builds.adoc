// Module included in the following assemblies:
//
// * /serverless/functions/serverless-functions-on-cluster-builds.adoc

:_content-type: PROCEDURE
[id="serverless-functions-creating-on-cluster-builds_{context}"]
= åœ¨é›†ç¾¤ä¸­æ„å»ºå’Œéƒ¨ç½²åŠŸèƒ½

æ‚¨å¯ä»¥ä½¿ç”¨ Knative (`kn`) CLI å¯åŠ¨åŠŸèƒ½é¡¹ç›®æ„å»ºï¼Œç„¶åç›´æ¥å°†åŠŸèƒ½éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚è‹¥è¦ä»¥è¿™ç§æ–¹å¼æ„å»ºåŠŸèƒ½é¡¹ç›®ï¼Œæ‚¨çš„åŠŸèƒ½é¡¹ç›®çš„æºä»£ç å¿…é¡»å­˜åœ¨äºå¯ä¾›é›†ç¾¤è®¿é—®çš„ Git å­˜å‚¨åº“åˆ†æ”¯ä¸­ã€‚

.å…ˆå†³æ¡ä»¶

* åœ¨é›†ç¾¤ä¸­å¿…é¡»å®‰è£… Uccps Pipelinesã€‚

* å·²å®‰è£… Uccps CLI (`oc`).

* å·²å®‰è£… Knative  (`kn`) CLI.

.æµç¨‹

. åœ¨æ‚¨è¦è¿è¡Œ Pipelines å’Œéƒ¨ç½²åŠŸèƒ½çš„æ¯ä¸ªå‘½åç©ºé—´ä¸­ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä»¥ä¸‹èµ„æºï¼š

.. åˆ›å»º `s2i` Tekton ä»»åŠ¡ï¼Œä»¥ä¾¿åœ¨ç®¡é“ä¸­ä½¿ç”¨ Source-to-Imageï¼š
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/openshift-knative/kn-plugin-func/serverless-1.26.0/pipelines/resources/tekton/task/func-s2i/0.1/func-s2i.yaml
----

.. åˆ›å»º `kn func` éƒ¨ç½² Tekton ä»»åŠ¡ï¼Œä»¥ä¾¿åœ¨ç®¡é“ä¸­éƒ¨ç½²è¯¥åŠŸèƒ½ï¼š
+
[source,terminal]
----
$ oc apply -f https://raw.githubusercontent.com/openshift-knative/kn-plugin-func/serverless-1.26.0/pipelines/resources/tekton/task/func-deploy/0.1/func-deploy.yaml
----

. åˆ›å»ºåŠŸèƒ½ï¼š
+
[source,terminal]
----
$ kn func create <function_name> -l <runtime>
----

. åœ¨åˆ›å»ºäº†æ–°çš„åŠŸèƒ½é¡¹ç›®åï¼Œæ‚¨å¿…é¡»å°†é¡¹ç›®æ·»åŠ åˆ° Git å­˜å‚¨åº“ï¼Œå¹¶ç¡®ä¿è¯¥å­˜å‚¨åº“å¯ä¾›é›†ç¾¤ä½¿ç”¨ã€‚å…³äºæ­¤ Git å­˜å‚¨åº“çš„ä¿¡æ¯ç”¨äºåœ¨ä¸‹ä¸€æ­¥ä¸­æ›´æ–°  `func.yaml` æ–‡ä»¶ã€‚

. æ›´æ–°åŠŸèƒ½é¡¹ç›®çš„ `func.yaml` æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œä»¥ä¾¿ä¸º Git ä»“åº“å¯ç”¨ on-cluster æ„å»ºï¼š
+
[source,yaml]
----
...
git:
  url: <git_repository_url> <1>
  revision: main <2>
  contextDir: <directory_path> <3>
...
----
<1> å¿…éœ€ã€‚æŒ‡å®šåŒ…å«åŠŸèƒ½æºä»£ç çš„ Git å­˜å‚¨åº“ã€‚
<2> å¯é€‰ã€‚æŒ‡å®šè¦ä½¿ç”¨çš„ Git å­˜å‚¨åº“ä¿®è®¢ã€‚è¿™å¯ä»¥æ˜¯åˆ†æ”¯ã€æ ‡ç­¾æˆ–æäº¤ã€‚
<3> å¯é€‰ã€‚å¦‚æœå‡½æ•°æ²¡æœ‰ä½äº Git å­˜å‚¨åº“æ ¹æ–‡ä»¶å¤¹ä¸­ï¼Œè¯·æŒ‡å®šå‡½æ•°çš„ç›®å½•çš„è·¯å¾„ã€‚

. å®æ–½æ‚¨åŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘ã€‚ç„¶åï¼Œä½¿ç”¨ Git æäº¤å¹¶æ¨é€æ›´æ”¹ã€‚

. éƒ¨ç½²åŠŸèƒ½ï¼š
+
[source,terminal]
----
$ kn func deploy --remote
----
+
å¦‚æœæ‚¨æ²¡æœ‰ç™»å½•åˆ°åŠŸèƒ½é…ç½®ä¸­å¼•ç”¨çš„å®¹å™¨ registryï¼Œç³»ç»Ÿä¼šæç¤ºæ‚¨ä¸ºæ‰˜ç®¡åŠŸèƒ½é•œåƒçš„è¿œç¨‹å®¹å™¨ registry æä¾›å‡­è¯ï¼š
+
.è¾“å‡ºå’Œæç¤ºç¤ºä¾‹
[source,terminal]
----
ğŸ•• Creating Pipeline resources
Please provide credentials for image registry used by Pipeline.
? Server: https://index.docker.io/v1/
? Username: my-repo
? Password: ********
   Function deployed at URL: http://test-function.default.svc.cluster.local
----

. è¦æ›´æ–°æ‚¨çš„åŠŸèƒ½ï¼Œä½¿ç”¨ Git æäº¤å¹¶æ¨é€æ–°çš„æ›´æ”¹ï¼Œç„¶åå†æ¬¡è¿è¡Œ `kn func deploy --remote` å‘½ä»¤ã€‚
